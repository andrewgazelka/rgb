cognitive-complexity-threshold = 100
excessive-nesting-threshold = 5        # TODO: limit
msrv = "1.91.0"
single-char-binding-names-threshold = 1
too-many-lines-threshold = 100

allow-expect-in-tests = true
allow-unwrap-in-tests = true
allow-print-in-tests = true
cargo-ignore-publish = true  # Enforce cargo_common_metadata even for publish = false crates

disallowed-types = [
    # Error handling - prefer eyre types
    # { path = "eyre::Result", reason = "use eyre::Result instead", replacement = "eyre::Result" },
    # { path = "eyre::Error", reason = "use eyre::Report instead", replacement = "eyre::Report" },
    # { path = "std::time::Duration", reason = "Time is not a synchronization primitive" }, # This is allowed for now because it can be really annoying to have absolutely no synchronization primitive in the codebase

    # Synchronization primitives - FORBIDDEN: use message passing instead
    # { path = "std::sync::Mutex", reason = "NEVER use mutexes. Use message passing (tokio::sync::mpsc, broadcast, oneshot) and actor model. See CLAUDE.md concurrency section." },
    # { path = "std::sync::RwLock", reason = "NEVER use RwLocks. Use message passing (tokio::sync::mpsc, broadcast, oneshot) and actor model. See CLAUDE.md concurrency section." },
    # { path = "std::sync::Condvar", reason = "NEVER use Condvars. Use message passing (tokio::sync::mpsc, broadcast, oneshot) and actor model. See CLAUDE.md concurrency section." },
    # { path = "parking_lot::Mutex", reason = "NEVER use mutexes (parking_lot or std). Use message passing (tokio::sync::mpsc, broadcast, oneshot) and actor model. See CLAUDE.md concurrency section." },
    # { path = "parking_lot::RwLock", reason = "NEVER use RwLocks (parking_lot or std). Use message passing (tokio::sync::mpsc, broadcast, oneshot) and actor model. See CLAUDE.md concurrency section." },
    # { path = "parking_lot::Condvar", reason = "NEVER use Condvars (parking_lot or std). Use message passing (tokio::sync::mpsc, broadcast, oneshot) and actor model. See CLAUDE.md concurrency section." },
]

disallowed-macros = [
    # { path = "eyre::eyre", reason = "use eyre::eyre instead", replacement = "eyre::eyre" },
    # { path = "eyre::bail", reason = "use eyre::bail instead", replacement = "eyre::bail" },
    # { path = "eyre::ensure", reason = "use eyre::ensure instead", replacement = "eyre::ensure" },

    # Logging - prefer tracing crate
    # { path = "println", reason = "use tracing crate instead (tracing::info!, tracing::debug!, etc.)", replacement = "tracing::info!" },
    # { path = "eprintln", reason = "use tracing crate instead (tracing::error!, tracing::warn!, etc.)", replacement = "tracing::error!" },
]

disallowed-methods = [
    # Time synchronization
    # { path = "std::time::Instant::now", reason = "Time is not a synchronization primitive; if this is not being used as a synchronization primitive, you can use #[expect(...)] to allow it" },
    # { path = "std::time::SystemTime::now", reason = "Time is not a synchronization primitive; if this is not being used as a synchronization primitive, you can use #[expect(...)] to allow it" },
    # { path = "std::time::Duration::from_secs", reason = "Time is not a synchronization primitive; if this is not being used as a synchronization primitive, you can use #[expect(...)] to allow it" },


    # Memory management
{ path = "std::vec::Vec::leak", reason = "no leaking memory" },
{ path = "std::mem::forget", reason = "no leaking memory" },
{ path = "std::boxed::Box::leak", reason = "no leaking memory" },

    # Synchronization primitives - FORBIDDEN: use message passing instead
# { path = "std::sync::Mutex::new", reason = "NEVER use mutexes. Use message passing (tokio::sync::mpsc, broadcast, oneshot) and actor model. See CLAUDE.md concurrency section." },
# { path = "std::sync::Mutex::lock", reason = "NEVER use mutexes. Use message passing (tokio::sync::mpsc, broadcast, oneshot) and actor model. See CLAUDE.md concurrency section." },
# { path = "std::sync::Mutex::try_lock", reason = "NEVER use mutexes. Use message passing (tokio::sync::mpsc, broadcast, oneshot) and actor model. See CLAUDE.md concurrency section." },
# { path = "std::sync::RwLock::new", reason = "NEVER use RwLocks. Use message passing (tokio::sync::mpsc, broadcast, oneshot) and actor model. See CLAUDE.md concurrency section." },
# { path = "std::sync::RwLock::read", reason = "NEVER use RwLocks. Use message passing (tokio::sync::mpsc, broadcast, oneshot) and actor model. See CLAUDE.md concurrency section." },
# { path = "std::sync::RwLock::write", reason = "NEVER use RwLocks. Use message passing (tokio::sync::mpsc, broadcast, oneshot) and actor model. See CLAUDE.md concurrency section." },
# { path = "std::sync::Condvar::new", reason = "NEVER use Condvars. Use message passing (tokio::sync::mpsc, broadcast, oneshot) and actor model. See CLAUDE.md concurrency section." },
# { path = "parking_lot::Mutex::new", reason = "NEVER use mutexes (parking_lot or std). Use message passing (tokio::sync::mpsc, broadcast, oneshot) and actor model. See CLAUDE.md concurrency section." },
# { path = "parking_lot::Mutex::lock", reason = "NEVER use mutexes (parking_lot or std). Use message passing (tokio::sync::mpsc, broadcast, oneshot) and actor model. See CLAUDE.md concurrency section." },
# { path = "parking_lot::Mutex::try_lock", reason = "NEVER use mutexes (parking_lot or std). Use message passing (tokio::sync::mpsc, broadcast, oneshot) and actor model. See CLAUDE.md concurrency section." },
# { path = "parking_lot::RwLock::new", reason = "NEVER use RwLocks (parking_lot or std). Use message passing (tokio::sync::mpsc, broadcast, oneshot) and actor model. See CLAUDE.md concurrency section." },
# { path = "parking_lot::RwLock::read", reason = "NEVER use RwLocks (parking_lot or std). Use message passing (tokio::sync::mpsc, broadcast, oneshot) and actor model. See CLAUDE.md concurrency section." },
# { path = "parking_lot::RwLock::write", reason = "NEVER use RwLocks (parking_lot or std). Use message passing (tokio::sync::mpsc, broadcast, oneshot) and actor model. See CLAUDE.md concurrency section." },
# { path = "parking_lot::Condvar::new", reason = "NEVER use Condvars (parking_lot or std). Use message passing (tokio::sync::mpsc, broadcast, oneshot) and actor model. See CLAUDE.md concurrency section." },

    # Error handling - prefer eyre::Result
    # { path = "std::result::Result::unwrap", reason = "use eyre::Result and proper error handling" },
    # { path = "std::result::Result::expect", reason = "use eyre::Result and proper error handling" },
    # { path = "std::option::Option::unwrap", reason = "handle None case explicitly" },
    # { path = "std::option::Option::expect", reason = "handle None case explicitly" },

    # Context methods - prefer eyre
    # { path = "eyre::Context::context", reason = "use eyre::Context::wrap_err instead", replacement = "wrap_err" },
    # { path = "eyre::Context::with_context", reason = "use eyre::Context::wrap_err_with instead", replacement = "wrap_err_with" },

    # Panic-inducing functions
{ path = "std::panic::panic_any", reason = "use eyre::Result for error handling" },

    # Threading - prefer structured concurrency
    # { path = "std::thread::spawn", reason = "prefer structured concurrency patterns" },
    # { path = "std::sync::mpsc::channel", reason = "prefer async channels or structured patterns" },

    # Async runtime - prevent nested runtime errors
    { path = "tokio::runtime::Runtime::block_on", reason = "causes 'nested runtime' panics when called from async context. Restructure: make functions async and use spawn_blocking only at highest level (e.g., in main or top-level handlers), not in libraries" },
    { path = "tokio::runtime::Handle::block_on", reason = "causes 'nested runtime' panics when called from async context. Restructure: make functions async and use spawn_blocking only at highest level (e.g., in main or top-level handlers), not in libraries" },

    # String operations that can panic
    # { path = "std::string::String::from_utf8", reason = "use from_utf8_lossy or handle invalid UTF-8 explicitly", replacement = "String::from_utf8_lossy" },
    # { path = "std::str::from_utf8", reason = "use from_utf8 with proper error handling" },

    # Process operations
{ path = "std::process::exit", reason = "prefer graceful shutdown patterns" },
{ path = "std::process::abort", reason = "prefer graceful error handling" },
]


allowed-duplicate-crates = [
    "getrandom",
    "hashbrown",
    "wasi",
    "windows-sys",
    "windows-targets",
    "windows_aarch64_gnullvm",
    "windows_aarch64_msvc",
    "windows_i686_gnu",
    "windows_i686_gnullvm",
    "windows_i686_msvc",
    "windows_x86_64_gnu",
    "windows_x86_64_gnullvm",
    "windows_x86_64_msvc",
]


doc-valid-idents = [
    "XPath",
    "AccessKit",
    "BibLaTeX",
    "BibTeX",
    "CamelCase",
    "ClojureScript",
    "CoAP",
    "CoffeeScript",
    "CoreFoundation",
    "CoreGraphics",
    "CoreText",
    "DevOps",
    "Direct2D",
    "Direct3D",
    "DirectWrite",
    "DirectX",
    "ECMAScript",
    "EiB",
    "FSEvent",
    "FSEvents",
    "FreeBSD",
    "GHz",
    "GPLv2",
    "GPLv3",
    "GiB",
    "GitHub",
    "GitLab",
    "GraphQL",
    "IPv4",
    "IPv6",
    "JavaScript",
    "KiB",
    "LaTeX",
    "MHz",
    "MiB",
    "MinGW",
    "NaN",
    "NaNs",
    "NetBSD",
    "OAuth",
    "OCaml",
    "OpenAI",
    "OpenAL",
    "OpenBSD",
    "OpenDNS",
    "OpenExr",
    "OpenGL",
    "OpenMP",
    "OpenSSH",
    "OpenSSL",
    "OpenStreetMap",
    "OpenTelemetry",
    "OpenType",
    "PiB",
    "PostScript",
    "ProtoBuf",
    "PureScript",
    "THz",
    "TeX",
    "TensorFlow",
    "TiB",
    "TrueType",
    "TypeScript",
    "WebAssembly",
    "WebGL",
    "WebGL2",
    "WebGPU",
    "WebP",
    "WebRTC",
    "WebSocket",
    "WebTransport",
    "YCbCr",
    "iOS",
    "macOS",
    "sRGB",
]
